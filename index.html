<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>JavaScript Promise迷你书</title>
</head>
<body>
<p>易函123</p>
    <script>
        // 需要从构造函数Promise（constructor）来创建一个新建promise对象作为接口
        const promise = new Promise(function(resolve, reject){
            // 在里面进行异步处理
            // 然后异步处理完成后调用resolve,reject
            if(true){
                /*异步操作成功*/
                resolve(42);  
            }else{
                /*异步操作失败*/
                reject(error)
            }
        })
        // 构造了一个Promise实例
        promise.then(function(value){
            console.log(value);
        }).catch(function(error){
            console.error(error);
        })
        
    </script>
    <script>
        // 含义：Promise是抽象异步处理对象以及对其进行各种操作的组件.
        // 大概处理流程：
        // 例子一
        function asyncFunction(){
            // new Promise() 会返回一个promise对象
            return new Promise(function(resolve,reject){
                setTimeout(function(){
                    resolve('Async Hello world');
                }, 16);
            })
        }
        // new Promise()对象中会返回设置.then调用返回时的回调函数
        asyncFunction().then(function(value){
            console.log(value);
        }).catch(function(error){
            console.log(errpr)
        })
    </script>
    <script>
        // 例子二
        function timeout(ms){
            return new Promise((resolve,reject)=>{
                setTimeout(resolve,ms,'done');
            });
        }
        timeout(100).then((value)=>{
            console.log(value)
        })
    </script>
    <script>
        //promise执行顺序
        let promiseS = new Promise(function(resolve,reject){
            console.log("Promise");
            resolve();
        })
        promiseS.then(function() {
            console.log("resolved");
        })
        console.log("Hi");
        // 首先输出的是Promise。
        // 然后，then方法指定的回调函数，将在当前脚本所有同步任务执行完才会执行;
        // 所以resolved最后输出。
    </script>
    <script>
        // 创建promise对象的流程
        // 1:new Promise(fn) 返回一个promise对象
        // 2：在fn中指定异步等处理：处理结果正常的话，调用resolve(处理结果值)，处理结果错误的话，调用reject(error对象)
    </script>

    <script>
            function getURL(URL) {
                return new Promise(function (resolve, reject) {
                    let req = new XMLHttpRequest();
                    req.open('GET', URL, true);
                    req.onload = function () {
                        if (req.status === 200) {
                            resolve(req.responseText);
                        } else {
                            reject(new Error(req.statusText));
                        }
                    };
                    req.onerror = function () {
                        reject(new Error(req.statusText));
                    };
                    req.send();
                });
            }
            // 运行示例
            let URL = "http://httpbin.org/get";
            getURL(URL).then(function onFulfilled(value){
                console.log(value);
            }).catch(function onRejected(error){
                console.error(error);
            });
    </script>
    
</body>
</html>
